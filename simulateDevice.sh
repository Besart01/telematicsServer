#!/bin/bash

# Configuration
HOST="localhost"
PORT="5025"
IMEI_HEX="000F333532303933303839313638383231"
PACKET_HEX="00000000000004658E09000001960FD4F5E8010CC287D6190AFF0A0000000003000000F00010000600EF0000F00000150400C800004502012F00000700B5002800B6002600423260001800000043102500440000000D0053000300F1000072DB00C700000000001000AD553400000000000001960FD41362010CC288E0190AF6A3010900A4040007012F0010000600EF0000F00100150500C800004501012F00000700B5002300B60022004232B4001800070043102300440000000D0053000300F1000072DB00C700000048001000AD550200000000000001960FD40F7A010CC2889E190AF640010900AC040006012F0010000600EF0000F00100150500C800004501012F01000700B5002300B60022004232B6001800060043102500440000000D0053000300F1000072DB00C700000048001000AD550200000000000001960FD407AA010CC2885B190AF61E010900B7040006012F0010000600EF0000F00100150500C800004501012F00000700B5002300B60022004232B6001800060043102700440000000D0053000300F1000072DB00C700000048001000AD550200000000000001960FD3F418010CC28430190B000401090157040000012F0010000600EF0000F00100150500C800004501012F01000700B5001800B60016004232E2001800000043102400440000000D0053000300F1000072DB00C70000001D001000AD54D700000000000001960FD3EC48010CC28430190B000401090157040000012F0010000600EF0000F00100150500C800004501012F00000700B5001800B6001600423328001800000043102700440000000D0053000300F1000072DB00C70000001D001000AD54D700000000000001960FD3E090010CC282B1190B00350109015704000100EF001E000F00EF0000F00100150500C800004502012F01001E00001F1700205A0025000026F4002719003519003A4E02F701000900B5005C00B6005B0042338C001800000043102700440000000D005300240266002B0000000500F1000072DB00C70000001D001000AD54D701850000D05801860000008E00000001010000114A544D5234334656343044303333333635000001960FD305D0010CC27D4A190AFF2B010A002F0E0000012F001E000F00EF0100F00100150400C800004501012F01001E00001F1F00205800250000260100271A00351A003A4D02F701000900B5000B00B60008004237F8001800000043102700440000000D0053002402B4002B0000000500F1000072DB00C70000001D001000AD54D701850000D05801860000007000000001010000114A544D5234334656343044303333333635000001960FD2EA78010CC27D4A190AFF2B010A002F0E0000012F001E000F00EF0100F00100150400C800004501012F00001E00001F220020570025000026FF00271A00351A003A4C02F701000900B5000B00B600080042380F001800000043102700440000000D005300240373002B0000000500F1000072DB00C70000001D001000AD54D701850000D05801860000006E00000001010000114A544D523433465634304430333333363509000008CC"

# Create temporary files for binary data
IMEI_FILE=$(mktemp)
PACKET_FILE=$(mktemp)

# Convert hex to binary using printf (handles null bytes properly)
printf "%b" "$(echo "$IMEI_HEX" | sed 's/\([0-9A-F]\{2\}\)/\\x\1/gI')" > "$IMEI_FILE"
printf "%b" "$(echo "$PACKET_HEX" | sed 's/\([0-9A-F]\{2\}\)/\\x\1/gI')" > "$PACKET_FILE"

echo "Connecting to $HOST:$PORT..."
(
  # Send IMEI immediately
  cat "$IMEI_FILE"
  
  # Wait 10 seconds
  sleep 10
  
  # Send data packet
  cat "$PACKET_FILE"
  
  # Keep connection open for 5 more seconds
  sleep 5
) | nc "$HOST" "$PORT"

# Clean up
rm -f "$IMEI_FILE" "$PACKET_FILE"
echo "Test sequence completed."